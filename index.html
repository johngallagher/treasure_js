<!DOCTYPE html>
<html>
<head>
  <title>Treasure JS Proof of Concept</title>
  <link href="css/application.css?body=1" media="all" rel="stylesheet" type="text/css">
  <link href="css/chosen.css?body=1" media="all" rel="stylesheet" type="text/css">
  <link href="select2/select2.css" media="all" rel="stylesheet" type="text/css">
  <meta content="authenticity_token" name="csrf-param">
  <meta content="JeN23VMeqzt9GSvOwBWhr3Zo+qkV7gg89R7Fd2Qkvpo=" name="csrf-token">

  <script type="text/javascript" src='jquery/jquery.js'></script>
  <script type="text/javascript" src='select2/select2.js'></script>
  <script type="text/javascript" src='node_modules/backbone/node_modules/underscore/underscore.js'></script>
  <script type="text/javascript" src='node_modules/backbone/backbone.js'></script>
  <script type="text/javascript" src='node_modules/backbone.localstorage/backbone.localStorage.js'></script>
  <script type="text/javascript" src='backbone.autocomplete.js'></script>
</head>
<body>
  <h1>Treasure JS Proof of Concept</h1>
  <form id="autocomplete-remote">
    <input id="plugin" autocomplete="off" style="width: 200px">
    <input id="select2" autocomplete="off" style="width: 200px">
  </form>
  <div id="r"></div>
</body>
<script type="text/javascript">

$(function () {

  var Term = Backbone.Model.extend({
    label: function () {
      return this.get("value");
    }
  });

  var Terms = Backbone.Collection.extend({
    url: function() { return 'http://localhost:3000/api/v1/searches.json' },
    model: Term
  });

  var terms = new Terms([]);

  var Query = Backbone.Collection.extend({
    model: Term
  });

  var query = new Query([]);
  query.on("add", function(term) {
    console.log("Term added: " + term);
  });

  new AutoCompleteView({
    input: $("#plugin"),
    model: terms,
    wait: 50,
    queryParameter: "q",
    minKeywordLength: 0,
    onSelect: function (model) {
      query.add(model);
    }
  }).render();

// $('#s2id_autogen1').val("")
  $(document).ready(function() {
    $('#select2').select2({
      initSelection : function (element, callback) {
        var data = [];
        $(element.val().split(" ")).each(function () {
            data.push({id: this, text: this});
        });
        callback(data);
      },
      multiple: true,
      minimumInputLength: 1,
      closeOnSelect: true,
      ajax: { 
        url: 'http://localhost:3000/api/v1/searches.json',
        // dataType: 'json',
        data: function (term, page) {
            return {
                q: term
            };
        },
        results: function (data, page) { 
            return {results: data};
        }
      }
    });
    $('#select2').on("change", function(e) { 
      $('#select2').select2("open");
    });
    
  });
});
</script>


</script>
</html>
