<!DOCTYPE html>
<html>
<head>
  <title>Treasure JS Proof of Concept</title>
  <link href="css/application.css?body=1" media="all" rel="stylesheet" type="text/css">
  <link href="css/chosen.css?body=1" media="all" rel="stylesheet" type="text/css">
  <meta content="authenticity_token" name="csrf-param">
  <meta content="JeN23VMeqzt9GSvOwBWhr3Zo+qkV7gg89R7Fd2Qkvpo=" name="csrf-token">
</head>
<body>

  <h1>Treasure JS Proof of Concept</h1>

  <select id="query" multiple="multiple" name="query[]"></select>

  <div id="results">
  </div>


</body>
<script type="text/javascript" src='jquery/jquery.js'></script>
<script type="text/javascript" src='chosen/chosen.jquery.js'></script>
<script type="text/javascript" src='node_modules/backbone/node_modules/underscore/underscore.js'></script>
<script type="text/javascript" src='node_modules/backbone/backbone.js'></script>
<script type="text/javascript" src='node_modules/url-template/lib/url-template.js'></script>
<script type="text/javascript" src='node_modules/backbone.localstorage/backbone.localStorage.js'></script>

<script type="text/template" id="condition-group-template">
<% _.each( groups, function( thisGroup){  %>
  <optgroup label="<%= thisGroup[0].get('group') %>">
  <% _.each( thisGroup, function( thisItem ){ %>
    <option value="<%= thisItem.get('id') %>"<%= thisItem.selectedAttribute() %>><%= thisItem.get('text') %></option>
    <% }) %>
  </optgroup>
  <% }) %>
</script>

<script type="text/template" id="selected-conditions-template">
<h3>Selected Criteria</h3>
<% _.each( conditions, function( thisCondition){  %>
  <div><span><%= thisCondition.get('group') %></span> - <span><%= thisCondition.get('text') %></span></div>
  <% }) %>
</script>

<script type="text/template" id="results-template">
<h3>Results</h3>
<% _.each( schools, function( thisSchool){  %>
  <div>
  <a href="<%= thisSchool.get('item') %>"><%= thisSchool.get('name') %></a>
  </div>
  <% }) %>
</script>

<script type="text/javascript">
$( document ).ready(function() {

  var typeOfEstablishments = [{parameter: "typeOfEstablishment", group: "Type", text: "Other Independent School", value: "Other Independent School"},
  {parameter: "typeOfEstablishment", group: "Type", text: "Voluntary Aided School", value: "Voluntary Aided School"},
  {parameter: "typeOfEstablishment", group: "Type", text: "Foundation School", value: "Foundation School"},
  {parameter: "typeOfEstablishment", group: "Type", text: "Community School", value: "Community School"},
  {parameter: "typeOfEstablishment", group: "Type", text: "Other Independent Special School", value: "Other Independent Special School"},
  {parameter: "typeOfEstablishment", group: "Type", text: "Community Special School", value: "Community Special School"},
  {parameter: "typeOfEstablishment", group: "Type", text: "LA Nursery School", value: "LA Nursery School"},
  {parameter: "typeOfEstablishment", group: "Type", text: "Pupil Referral Unit", value: "Pupil Referral Unit"},
  {parameter: "typeOfEstablishment", group: "Type", text: "City Technology College", value: "City Technology College"},
  {parameter: "typeOfEstablishment", group: "Type", text: "Voluntary Controlled School", value: "Voluntary Controlled School"},
  {parameter: "typeOfEstablishment", group: "Type", text: "Independent School Approved for SEN Pupils", value: "Independent School Approved for SEN Pupils"},
  {parameter: "typeOfEstablishment", group: "Type", text: "Foundation Special School", value: "Foundation Special School"},
  {parameter: "typeOfEstablishment", group: "Type", text: "Miscellaneous", value: "Miscellaneous"},
  {parameter: "typeOfEstablishment", group: "Type", text: "Non-Maintained Special School", value: "Non-Maintained Special School"},
  {parameter: "typeOfEstablishment", group: "Type", text: "Academies", value: "Academies"},
  {parameter: "typeOfEstablishment", group: "Type", text: "Legacy types", value: "Legacy types"},
  {parameter: "typeOfEstablishment", group: "Type", text: "Playing for Success Centres", value: "Playing for Success Centres"},
  {parameter: "typeOfEstablishment", group: "Type", text: "Further Education", value: "Further Education"},
  {parameter: "typeOfEstablishment", group: "Type", text: "Institution funded by other Government Department", value: "Institution funded by other Government Department" },
  {parameter: "typeOfEstablishment", group: "Type", text: "Service Childrens Education", value: "Service Childrens Education"},
  {parameter: "typeOfEstablishment", group: "Type", text: "Secure Units", value: "Secure Units"},
  {parameter: "typeOfEstablishment", group: "Type", text: "European Schools", value: "European Schools"},
  {parameter: "typeOfEstablishment", group: "Type", text: "Offshore Schools", value: "Offshore Schools"},
  {parameter: "typeOfEstablishment", group: "Type", text: "Sixth Form Centres", value: "Sixth Form Centres"},
  {parameter: "typeOfEstablishment", group: "Type", text: "Special College", value: "Special College"},
  {parameter: "typeOfEstablishment", group: "Type", text: "Higher Education Institutions", value: "Higher Education Institutions"},
  {parameter: "typeOfEstablishment", group: "Type", text: "Welsh Establishment", value: "Welsh Establishment"},
  {parameter: "typeOfEstablishment", group: "Type", text: "EY Setting", value: "EY Setting"}]

  var districtAdministratives = [{parameter: "districtAdministrative", group: "Location", text: "Southwark" , value: "Southwark"},
  {parameter: "districtAdministrative", group: "Location", text: "Lambeth" , value: "Lambeth"},
  {parameter: "districtAdministrative", group: "Location", text: "Westminster" , value: "Westminster"},
  {parameter: "districtAdministrative", group: "Location", text: "Kensington and Chelsea" , value: "Kensington and Chelsea"},
  {parameter: "districtAdministrative", group: "Location", text: "Wandsworth" , value: "Wandsworth"},
  {parameter: "districtAdministrative", group: "Location", text: "Milton Keynes" , value: "Milton Keynes"},
  {parameter: "districtAdministrative", group: "Location", text: "Thanet" , value: "Thanet"},
  {parameter: "districtAdministrative", group: "Location", text: "Barking and Dagenham" , value: "Barking and Dagenham"},
  {parameter: "districtAdministrative", group: "Location", text: "Barnet" , value: "Barnet"},
  {parameter: "districtAdministrative", group: "Location", text: "Lewisham" , value: "Lewisham"},
  {parameter: "districtAdministrative", group: "Location", text: "Bromley" , value: "Bromley"},
  {parameter: "districtAdministrative", group: "Location", text: "Greenwich" , value: "Greenwich"},
  {parameter: "districtAdministrative", group: "Location", text: "Tower Hamlets" , value: "Tower Hamlets"},
  {parameter: "districtAdministrative", group: "Location", text: "Lewes" , value: "Lewes"},
  {parameter: "districtAdministrative", group: "Location", text: "Bexley" , value: "Bexley"},
  {parameter: "districtAdministrative", group: "Location", text: "Brent" , value: "Brent"},
  {parameter: "districtAdministrative", group: "Location", text: "Enfield" , value: "Enfield"},
  {parameter: "districtAdministrative", group: "Location", text: "Birmingham" , value: "Birmingham"},
  {parameter: "districtAdministrative", group: "Location", text: "Waltham Forest" , value: "Waltham Forest"},
  {parameter: "districtAdministrative", group: "Location", text: "Coventry" , value: "Coventry"},
  {parameter: "districtAdministrative", group: "Location", text: "Solihull" , value: "Solihull"},
  {parameter: "districtAdministrative", group: "Location", text: "Stratford-on-Avon" , value: "Stratford-on-Avon"},
  {parameter: "districtAdministrative", group: "Location", text: "Bromsgrove" , value: "Bromsgrove"},
  {parameter: "districtAdministrative", group: "Location", text: "Wirral" , value: "Wirral"},
  {parameter: "districtAdministrative", group: "Location", text: "St. Helens" , value: "St. Helens"},
  {parameter: "districtAdministrative", group: "Location", text: "Liverpool" , value: "Liverpool"},
  {parameter: "districtAdministrative", group: "Location", text: "Knowsley" , value: "Knowsley"},
  {parameter: "districtAdministrative", group: "Location", text: "Wolverhampton" , value: "Wolverhampton"},
  {parameter: "districtAdministrative", group: "Location", text: "South Staffordshire" , value: "South Staffordshire"},
  {parameter: "districtAdministrative", group: "Location", text: "Sefton" , value: "Sefton"},
  {parameter: "districtAdministrative", group: "Location", text: "Telford and Wrekin" , value: "Telford and Wrekin"},
  {parameter: "districtAdministrative", group: "Location", text: "Bolton" , value: "Bolton"},
  {parameter: "districtAdministrative", group: "Location", text: "Bury" , value: "Bury"},
  {parameter: "districtAdministrative", group: "Location", text: "Salford" , value: "Salford"},
  {parameter: "districtAdministrative", group: "Location", text: "Manchester" , value: "Manchester"},
  {parameter: "districtAdministrative", group: "Location", text: "Oldham" , value: "Oldham"},
  {parameter: "districtAdministrative", group: "Location", text: "Macclesfield" , value: "Macclesfield"},
  {parameter: "districtAdministrative", group: "Location", text: "Congleton" , value: "Congleton"},
  {parameter: "districtAdministrative", group: "Location", text: "Chorley" , value: "Chorley"},
  {parameter: "districtAdministrative", group: "Location", text: "Rochdale" , value: "Rochdale"},
  {parameter: "districtAdministrative", group: "Location", text: "Stockport" , value: "Stockport"},
  {parameter: "districtAdministrative", group: "Location", text: "High Peak" , value: "High Peak"},
  {parameter: "districtAdministrative", group: "Location", text: "Trafford" , value: "Trafford"},
  {parameter: "districtAdministrative", group: "Location", text: "Tameside" , value: "Tameside"},
  {parameter: "districtAdministrative", group: "Location", text: "Wigan" , value: "Wigan"},
  {parameter: "districtAdministrative", group: "Location", text: "Barnsley" , value: "Barnsley"},
  {parameter: "districtAdministrative", group: "Location", text: "Doncaster" , value: "Doncaster"},
  {parameter: "districtAdministrative", group: "Location", text: "Rotherham" , value: "Rotherham"},
  {parameter: "districtAdministrative", group: "Location", text: "Sheffield" , value: "Sheffield"},
  {parameter: "districtAdministrative", group: "Location", text: "Bradford" , value: "Bradford"},
  {parameter: "districtAdministrative", group: "Location", text: "Leeds" , value: "Leeds"},
  {parameter: "districtAdministrative", group: "Location", text: "Harrogate" , value: "Harrogate"},
  {parameter: "districtAdministrative", group: "Location", text: "Calderdale" , value: "Calderdale"},
  {parameter: "districtAdministrative", group: "Location", text: "Kirklees" , value: "Kirklees"},
  {parameter: "districtAdministrative", group: "Location", text: "North Tyneside" , value: "North Tyneside"},
  {parameter: "districtAdministrative", group: "Location", text: "North Somerset" , value: "North Somerset"},
  {parameter: "districtAdministrative", group: "Location", text: "Bath and North East Somerset" , value: "Bath and North East Somerset"},
  {parameter: "districtAdministrative", group: "Location", text: "South Gloucestershire" , value: "South Gloucestershire"},
  {parameter: "districtAdministrative", group: "Location", text: "Bristol, City of" , value: "Bristol, City of"},
  {parameter: "districtAdministrative", group: "Location", text: "Isles of Scilly" , value: "Isles of Scilly"},
  {parameter: "districtAdministrative", group: "Location", text: "Mid Bedfordshire" , value: "Mid Bedfordshire"},
  {parameter: "districtAdministrative", group: "Location", text: "Sunderland" , value: "Sunderland"},
  {parameter: "districtAdministrative", group: "Location", text: "South Tyneside" , value: "South Tyneside"},
  {parameter: "districtAdministrative", group: "Location", text: "Newcastle upon Tyne" , value: "Newcastle upon Tyne"},
  {parameter: "districtAdministrative", group: "Location", text: "Luton" , value: "Luton"},
  {parameter: "districtAdministrative", group: "Location", text: "Bedford" , value: "Bedford"},
  {parameter: "districtAdministrative", group: "Location", text: "West Somerset" , value: "West Somerset"},
  {parameter: "districtAdministrative", group: "Location", text: "Broxtowe" , value: "Broxtowe"},
  {parameter: "districtAdministrative", group: "Location", text: "Thurrock" , value: "Thurrock"},
  {parameter: "districtAdministrative", group: "Location", text: "Sedgefield" , value: "Sedgefield"},
  {parameter: "districtAdministrative", group: "Location", text: "South Bedfordshire" , value: "South Bedfordshire"},
  {parameter: "districtAdministrative", group: "Location", text: "Reading" , value: "Reading"},
  {parameter: "districtAdministrative", group: "Location", text: "Windsor and Maidenhead" , value: "Windsor and Maidenhead"},
  {parameter: "districtAdministrative", group: "Location", text: "West Berkshire" , value: "West Berkshire"},
  {parameter: "districtAdministrative", group: "Location", text: "Wokingham" , value: "Wokingham"},
  {parameter: "districtAdministrative", group: "Location", text: "Slough" , value: "Slough"},
  {parameter: "districtAdministrative", group: "Location", text: "Bracknell Forest" , value: "Bracknell Forest"},
  {parameter: "districtAdministrative", group: "Location", text: "Merton" , value: "Merton"},
  {parameter: "districtAdministrative", group: "Location", text: "South Somerset" , value: "South Somerset"},
  {parameter: "districtAdministrative", group: "Location", text: "Aylesbury Vale" , value: "Aylesbury Vale"},
  {parameter: "districtAdministrative", group: "Location", text: "South Bucks" , value: "South Bucks"},
  {parameter: "districtAdministrative", group: "Location", text: "Chiltern" , value: "Chiltern"},
  {parameter: "districtAdministrative", group: "Location", text: "Wycombe" , value: "Wycombe"},
  {parameter: "districtAdministrative", group: "Location", text: "Fenland" , value: "Fenland"},
  {parameter: "districtAdministrative", group: "Location", text: "Peterborough" , value: "Peterborough"},
  {parameter: "districtAdministrative", group: "Location", text: "Huntingdonshire" , value: "Huntingdonshire"},
  {parameter: "districtAdministrative", group: "Location", text: "South Cambridgeshire" , value: "South Cambridgeshire"},
  {parameter: "districtAdministrative", group: "Location", text: "Cambridge" , value: "Cambridge"},
  {parameter: "districtAdministrative", group: "Location", text: "East Cambridgeshire" , value: "East Cambridgeshire"},
  {parameter: "districtAdministrative", group: "Location", text: "Chester" , value: "Chester"},
  {parameter: "districtAdministrative", group: "Location", text: "Ellesmere Port & Neston" , value: "Ellesmere Port & Neston"},
  {parameter: "districtAdministrative", group: "Location", text: "Halton" , value: "Halton"},
  {parameter: "districtAdministrative", group: "Location", text: "Vale Royal" , value: "Vale Royal"},
  {parameter: "districtAdministrative", group: "Location", text: "Warrington" , value: "Warrington"},
  {parameter: "districtAdministrative", group: "Location", text: "Crewe and Nantwich" , value: "Crewe and Nantwich"},
  {parameter: "districtAdministrative", group: "Location", text: "King's Lynn and West Norfolk" , value: "King's Lynn and West Norfolk"},
  {parameter: "districtAdministrative", group: "Location", text: "Redcar and Cleveland" , value: "Redcar and Cleveland"},
  {parameter: "districtAdministrative", group: "Location", text: "Carrick" , value: "Carrick"},
  {parameter: "districtAdministrative", group: "Location", text: "Kerrier" , value: "Kerrier"},
  {parameter: "districtAdministrative", group: "Location", text: "Penwith" , value: "Penwith"},
  {parameter: "districtAdministrative", group: "Location", text: "Stockton-on-Tees" , value: "Stockton-on-Tees"},
  {parameter: "districtAdministrative", group: "Location", text: "Hartlepool" , value: "Hartlepool"},
  {parameter: "districtAdministrative", group: "Location", text: "Middlesbrough" , value: "Middlesbrough"},
  {parameter: "districtAdministrative", group: "Location", text: "Allerdale" , value: "Allerdale"},
  {parameter: "districtAdministrative", group: "Location", text: "South Lakeland" , value: "South Lakeland"},
  {parameter: "districtAdministrative", group: "Location", text: "Barrow-in-Furness" , value: "Barrow-in-Furness"},
  {parameter: "districtAdministrative", group: "Location", text: "Carlisle" , value: "Carlisle"},
  {parameter: "districtAdministrative", group: "Location", text: "Copeland" , value: "Copeland"},
  {parameter: "districtAdministrative", group: "Location", text: "Eden" , value: "Eden"},
  {parameter: "districtAdministrative", group: "Location", text: "Derbyshire Dales" , value: "Derbyshire Dales"},
  {parameter: "districtAdministrative", group: "Location", text: "Derby" , value: "Derby"},
  {parameter: "districtAdministrative", group: "Location", text: "Amber Valley" , value: "Amber Valley"},
  {parameter: "districtAdministrative", group: "Location", text: "Bolsover" , value: "Bolsover"},
  {parameter: "districtAdministrative", group: "Location", text: "North East Derbyshire" , value: "North East Derbyshire"},
  {parameter: "districtAdministrative", group: "Location", text: "Erewash" , value: "Erewash"},
  {parameter: "districtAdministrative", group: "Location", text: "Chesterfield" , value: "Chesterfield"},
  {parameter: "districtAdministrative", group: "Location", text: "South Derbyshire" , value: "South Derbyshire"},
  {parameter: "districtAdministrative", group: "Location", text: "Derwentside" , value: "Derwentside"},
  {parameter: "districtAdministrative", group: "Location", text: "Easington" , value: "Easington"},
  {parameter: "districtAdministrative", group: "Location", text: "Wear Valley" , value: "Wear Valley"},
  {parameter: "districtAdministrative", group: "Location", text: "Darlington" , value: "Darlington"},
  {parameter: "districtAdministrative", group: "Location", text: "Durham" , value: "Durham"},
  {parameter: "districtAdministrative", group: "Location", text: "Teesdale" , value: "Teesdale"},
  {parameter: "districtAdministrative", group: "Location", text: "Chester-le-Street" , value: "Chester-le-Street"},
  {parameter: "districtAdministrative", group: "Location", text: "North Dorset" , value: "North Dorset"},
  {parameter: "districtAdministrative", group: "Location", text: "Poole" , value: "Poole"},
  {parameter: "districtAdministrative", group: "Location", text: "Bournemouth" , value: "Bournemouth"},
  {parameter: "districtAdministrative", group: "Location", text: "Weymouth and Portland" , value: "Weymouth and Portland"},
  {parameter: "districtAdministrative", group: "Location", text: "West Dorset" , value: "West Dorset"},
  {parameter: "districtAdministrative", group: "Location", text: "East Dorset" , value: "East Dorset"},
  {parameter: "districtAdministrative", group: "Location", text: "Purbeck" , value: "Purbeck"},
  {parameter: "districtAdministrative", group: "Location", text: "Christchurch" , value: "Christchurch"},
  {parameter: "districtAdministrative", group: "Location", text: "Wealden" , value: "Wealden"},
  {parameter: "districtAdministrative", group: "Location", text: "Brighton and Hove" , value: "Brighton and Hove"},
  {parameter: "districtAdministrative", group: "Location", text: "Rother" , value: "Rother"},
  {parameter: "districtAdministrative", group: "Location", text: "Hastings" , value: "Hastings"},
  {parameter: "districtAdministrative", group: "Location", text: "Eastbourne" , value: "Eastbourne"},
  {parameter: "districtAdministrative", group: "Location", text: "Braintree" , value: "Braintree"},
  {parameter: "districtAdministrative", group: "Location", text: "Colchester" , value: "Colchester"},
  {parameter: "districtAdministrative", group: "Location", text: "Tendring" , value: "Tendring"},
  {parameter: "districtAdministrative", group: "Location", text: "Southend-on-Sea" , value: "Southend-on-Sea"},
  {parameter: "districtAdministrative", group: "Location", text: "Harlow" , value: "Harlow"},
  {parameter: "districtAdministrative", group: "Location", text: "Chelmsford" , value: "Chelmsford"},
  {parameter: "districtAdministrative", group: "Location", text: "Rochford" , value: "Rochford"},
  {parameter: "districtAdministrative", group: "Location", text: "Uttlesford" , value: "Uttlesford"},
  {parameter: "districtAdministrative", group: "Location", text: "Maldon" , value: "Maldon"},
  {parameter: "districtAdministrative", group: "Location", text: "Epping Forest" , value: "Epping Forest"},
  {parameter: "districtAdministrative", group: "Location", text: "Castle Point" , value: "Castle Point"},
  {parameter: "districtAdministrative", group: "Location", text: "Basildon" , value: "Basildon"},
  {parameter: "districtAdministrative", group: "Location", text: "Brentwood" , value: "Brentwood"},
  {parameter: "districtAdministrative", group: "Location", text: "Forest of Dean" , value: "Forest of Dean"},
  {parameter: "districtAdministrative", group: "Location", text: "Cotswold" , value: "Cotswold"},
  {parameter: "districtAdministrative", group: "Location", text: "Tewkesbury" , value: "Tewkesbury"},
  {parameter: "districtAdministrative", group: "Location", text: "Gloucester" , value: "Gloucester"},
  {parameter: "districtAdministrative", group: "Location", text: "Stroud" , value: "Stroud"},
  {parameter: "districtAdministrative", group: "Location", text: "Cheltenham" , value: "Cheltenham"},
  {parameter: "districtAdministrative", group: "Location", text: "Portsmouth" , value: "Portsmouth"},
  {parameter: "districtAdministrative", group: "Location", text: "Gosport" , value: "Gosport"},
  {parameter: "districtAdministrative", group: "Location", text: "Southampton" , value: "Southampton"},
  {parameter: "districtAdministrative", group: "Location", text: "Basingstoke and Deane" , value: "Basingstoke and Deane"},
  {parameter: "districtAdministrative", group: "Location", text: "East Hampshire" , value: "East Hampshire"},
  {parameter: "districtAdministrative", group: "Location", text: "Rushmoor" , value: "Rushmoor"},
  {parameter: "districtAdministrative", group: "Location", text: "Test Valley" , value: "Test Valley"},
  {parameter: "districtAdministrative", group: "Location", text: "Eastleigh" , value: "Eastleigh"},
  {parameter: "districtAdministrative", group: "Location", text: "Havant" , value: "Havant"},
  {parameter: "districtAdministrative", group: "Location", text: "New Forest" , value: "New Forest"},
  {parameter: "districtAdministrative", group: "Location", text: "Fareham" , value: "Fareham"},
  {parameter: "districtAdministrative", group: "Location", text: "Winchester" , value: "Winchester"},
  {parameter: "districtAdministrative", group: "Location", text: "Hart" , value: "Hart"},
  {parameter: "districtAdministrative", group: "Location", text: "Malvern Hills" , value: "Malvern Hills"},
  {parameter: "districtAdministrative", group: "Location", text: "Wyre Forest" , value: "Wyre Forest"},
  {parameter: "districtAdministrative", group: "Location", text: "Worcester" , value: "Worcester"},
  {parameter: "districtAdministrative", group: "Location", text: "Herefordshire, County of" , value: "Herefordshire, County of"},
  {parameter: "districtAdministrative", group: "Location", text: "Wychavon" , value: "Wychavon"},
  {parameter: "districtAdministrative", group: "Location", text: "Redditch" , value: "Redditch"},
  {parameter: "districtAdministrative", group: "Location", text: "Kingston upon Hull, City of" , value: "Kingston upon Hull, City of"},
  {parameter: "districtAdministrative", group: "Location", text: "East Hertfordshire" , value: "East Hertfordshire"},
  {parameter: "districtAdministrative", group: "Location", text: "East Riding of Yorkshire" , value: "East Riding of Yorkshire"},
  {parameter: "districtAdministrative", group: "Location", text: "Hillingdon" , value: "Hillingdon"},
  {parameter: "districtAdministrative", group: "Location", text: "Burnley" , value: "Burnley"},
  {parameter: "districtAdministrative", group: "Location", text: "North Lincolnshire" , value: "North Lincolnshire"},
  {parameter: "districtAdministrative", group: "Location", text: "North East Lincolnshire" , value: "North East Lincolnshire"},
  {parameter: "districtAdministrative", group: "Location", text: "Hertsmere" , value: "Hertsmere"},
  {parameter: "districtAdministrative", group: "Location", text: "Stevenage" , value: "Stevenage"},
  {parameter: "districtAdministrative", group: "Location", text: "North Hertfordshire" , value: "North Hertfordshire"},
  {parameter: "districtAdministrative", group: "Location", text: "St Albans" , value: "St Albans"},
  {parameter: "districtAdministrative", group: "Location", text: "Dacorum" , value: "Dacorum"},
  {parameter: "districtAdministrative", group: "Location", text: "Three Rivers" , value: "Three Rivers"},
  {parameter: "districtAdministrative", group: "Location", text: "Welwyn Hatfield" , value: "Welwyn Hatfield"},
  {parameter: "districtAdministrative", group: "Location", text: "Watford" , value: "Watford"},
  {parameter: "districtAdministrative", group: "Location", text: "Broxbourne" , value: "Broxbourne"},
  {parameter: "districtAdministrative", group: "Location", text: "Gravesham" , value: "Gravesham"},
  {parameter: "districtAdministrative", group: "Location", text: "Ashford" , value: "Ashford"},
  {parameter: "districtAdministrative", group: "Location", text: "Medway" , value: "Medway"},
  {parameter: "districtAdministrative", group: "Location", text: "Dover" , value: "Dover"},
  {parameter: "districtAdministrative", group: "Location", text: "Canterbury" , value: "Canterbury"},
  {parameter: "districtAdministrative", group: "Location", text: "Swale" , value: "Swale"},
  {parameter: "districtAdministrative", group: "Location", text: "Tonbridge and Malling" , value: "Tonbridge and Malling"},
  {parameter: "districtAdministrative", group: "Location", text: "Tunbridge Wells" , value: "Tunbridge Wells"},
  {parameter: "districtAdministrative", group: "Location", text: "Dartford" , value: "Dartford"},
  {parameter: "districtAdministrative", group: "Location", text: "Sevenoaks" , value: "Sevenoaks"},
  {parameter: "districtAdministrative", group: "Location", text: "Maidstone" , value: "Maidstone"},
  {parameter: "districtAdministrative", group: "Location", text: "Shepway" , value: "Shepway"},
  {parameter: "districtAdministrative", group: "Location", text: "Hyndburn" , value: "Hyndburn"},
  {parameter: "districtAdministrative", group: "Location", text: "Lancaster" , value: "Lancaster"},
  {parameter: "districtAdministrative", group: "Location", text: "Pendle" , value: "Pendle"},
  {parameter: "districtAdministrative", group: "Location", text: "West Lancashire" , value: "West Lancashire"},
  {parameter: "districtAdministrative", group: "Location", text: "Preston" , value: "Preston"},
  {parameter: "districtAdministrative", group: "Location", text: "Blackburn with Darwen" , value: "Blackburn with Darwen"},
  {parameter: "districtAdministrative", group: "Location", text: "Rossendale" , value: "Rossendale"},
  {parameter: "districtAdministrative", group: "Location", text: "Wyre" , value: "Wyre"},
  {parameter: "districtAdministrative", group: "Location", text: "Fylde" , value: "Fylde"},
  {parameter: "districtAdministrative", group: "Location", text: "South Ribble" , value: "South Ribble"},
  {parameter: "districtAdministrative", group: "Location", text: "Blackpool" , value: "Blackpool"},
  {parameter: "districtAdministrative", group: "Location", text: "Ribble Valley" , value: "Ribble Valley"},
  {parameter: "districtAdministrative", group: "Location", text: "Leicester" , value: "Leicester"},
  {parameter: "districtAdministrative", group: "Location", text: "Blaby" , value: "Blaby"},
  {parameter: "districtAdministrative", group: "Location", text: "Melton" , value: "Melton"},
  {parameter: "districtAdministrative", group: "Location", text: "North West Leicestershire" , value: "North West Leicestershire"},
  {parameter: "districtAdministrative", group: "Location", text: "Harborough" , value: "Harborough"},
  {parameter: "districtAdministrative", group: "Location", text: "Charnwood" , value: "Charnwood"},
  {parameter: "districtAdministrative", group: "Location", text: "Hinckley and Bosworth" , value: "Hinckley and Bosworth"},
  {parameter: "districtAdministrative", group: "Location", text: "Oadby and Wigston" , value: "Oadby and Wigston"},
  {parameter: "districtAdministrative", group: "Location", text: "Rutland" , value: "Rutland"},
  {parameter: "districtAdministrative", group: "Location", text: "South Kesteven" , value: "South Kesteven"},
  {parameter: "districtAdministrative", group: "Location", text: "Lincoln" , value: "Lincoln"},
  {parameter: "districtAdministrative", group: "Location", text: "East Lindsey" , value: "East Lindsey"},
  {parameter: "districtAdministrative", group: "Location", text: "Boston" , value: "Boston"},
  {parameter: "districtAdministrative", group: "Location", text: "North Kesteven" , value: "North Kesteven"},
  {parameter: "districtAdministrative", group: "Location", text: "South Holland" , value: "South Holland"},
  {parameter: "districtAdministrative", group: "Location", text: "West Lindsey" , value: "West Lindsey"},
  {parameter: "districtAdministrative", group: "Location", text: "Broadland" , value: "Broadland"},
  {parameter: "districtAdministrative", group: "Location", text: "Norwich" , value: "Norwich"},
  {parameter: "districtAdministrative", group: "Location", text: "Great Yarmouth" , value: "Great Yarmouth"},
  {parameter: "districtAdministrative", group: "Location", text: "Breckland" , value: "Breckland"},
  {parameter: "districtAdministrative", group: "Location", text: "North Norfolk" , value: "North Norfolk"},
  {parameter: "districtAdministrative", group: "Location", text: "South Norfolk" , value: "South Norfolk"},
  {parameter: "districtAdministrative", group: "Location", text: "Scarborough" , value: "Scarborough"},
  {parameter: "districtAdministrative", group: "Location", text: "Hambleton" , value: "Hambleton"},
  {parameter: "districtAdministrative", group: "Location", text: "Ryedale" , value: "Ryedale"},
  {parameter: "districtAdministrative", group: "Location", text: "York" , value: "York"},
  {parameter: "districtAdministrative", group: "Location", text: "Selby" , value: "Selby"},
  {parameter: "districtAdministrative", group: "Location", text: "Craven" , value: "Craven"},
  {parameter: "districtAdministrative", group: "Location", text: "Richmondshire" , value: "Richmondshire"},
  {parameter: "districtAdministrative", group: "Location", text: "Kettering" , value: "Kettering"},
  {parameter: "districtAdministrative", group: "Location", text: "Wellingborough" , value: "Wellingborough"},
  {parameter: "districtAdministrative", group: "Location", text: "Northampton" , value: "Northampton"},
  {parameter: "districtAdministrative", group: "Location", text: "Hackney" , value: "Hackney"},
  {parameter: "districtAdministrative", group: "Location", text: "Daventry" , value: "Daventry"},
  {parameter: "districtAdministrative", group: "Location", text: "South Northamptonshire" , value: "South Northamptonshire"},
  {parameter: "districtAdministrative", group: "Location", text: "East Northamptonshire" , value: "East Northamptonshire"},
  {parameter: "districtAdministrative", group: "Location", text: "Corby" , value: "Corby"},
  {parameter: "districtAdministrative", group: "Location", text: "Nottingham" , value: "Nottingham"},
  {parameter: "districtAdministrative", group: "Location", text: "Bassetlaw" , value: "Bassetlaw"},
  {parameter: "districtAdministrative", group: "Location", text: "Ashfield" , value: "Ashfield"},
  {parameter: "districtAdministrative", group: "Location", text: "Mansfield" , value: "Mansfield"},
  {parameter: "districtAdministrative", group: "Location", text: "Gedling" , value: "Gedling"},
  {parameter: "districtAdministrative", group: "Location", text: "Newark and Sherwood" , value: "Newark and Sherwood"},
  {parameter: "districtAdministrative", group: "Location", text: "Rushcliffe" , value: "Rushcliffe"},
  {parameter: "districtAdministrative", group: "Location", text: "Oxford" , value: "Oxford"},
  {parameter: "districtAdministrative", group: "Location", text: "Vale of White Horse" , value: "Vale of White Horse"},
  {parameter: "districtAdministrative", group: "Location", text: "West Oxfordshire" , value: "West Oxfordshire"},
  {parameter: "districtAdministrative", group: "Location", text: "Cherwell" , value: "Cherwell"},
  {parameter: "districtAdministrative", group: "Location", text: "South Oxfordshire" , value: "South Oxfordshire"},
  {parameter: "districtAdministrative", group: "Location", text: "North Shropshire" , value: "North Shropshire"},
  {parameter: "districtAdministrative", group: "Location", text: "South Shropshire" , value: "South Shropshire"},
  {parameter: "districtAdministrative", group: "Location", text: "Shrewsbury and Atcham" , value: "Shrewsbury and Atcham"},
  {parameter: "districtAdministrative", group: "Location", text: "Bridgnorth" , value: "Bridgnorth"},
  {parameter: "districtAdministrative", group: "Location", text: "Oswestry" , value: "Oswestry"},
  {parameter: "districtAdministrative", group: "Location", text: "Sedgemoor" , value: "Sedgemoor"},
  {parameter: "districtAdministrative", group: "Location", text: "Mendip" , value: "Mendip"},
  {parameter: "districtAdministrative", group: "Location", text: "Taunton Deane" , value: "Taunton Deane"},
  {parameter: "districtAdministrative", group: "Location", text: "Stoke-on-Trent" , value: "Stoke-on-Trent"},
  {parameter: "districtAdministrative", group: "Location", text: "Cannock Chase" , value: "Cannock Chase"},
  {parameter: "districtAdministrative", group: "Location", text: "Newcastle-under-Lyme" , value: "Newcastle-under-Lyme"},
  {parameter: "districtAdministrative", group: "Location", text: "Nuneaton and Bedworth" , value: "Nuneaton and Bedworth"},
  {parameter: "districtAdministrative", group: "Location", text: "Croydon" , value: "Croydon"},
  {parameter: "districtAdministrative", group: "Location", text: "East Staffordshire" , value: "East Staffordshire"},
  {parameter: "districtAdministrative", group: "Location", text: "Lichfield" , value: "Lichfield"},
  {parameter: "districtAdministrative", group: "Location", text: "Staffordshire Moorlands" , value: "Staffordshire Moorlands"},
  {parameter: "districtAdministrative", group: "Location", text: "Stafford" , value: "Stafford"},
  {parameter: "districtAdministrative", group: "Location", text: "Tamworth" , value: "Tamworth"},
  {parameter: "districtAdministrative", group: "Location", text: "Ipswich" , value: "Ipswich"},
  {parameter: "districtAdministrative", group: "Location", text: "Woking" , value: "Woking"},
  {parameter: "districtAdministrative", group: "Location", text: "Waverley" , value: "Waverley"},
  {parameter: "districtAdministrative", group: "Location", text: "Elmbridge" , value: "Elmbridge"},
  {parameter: "districtAdministrative", group: "Location", text: "Runnymede" , value: "Runnymede"},
  {parameter: "districtAdministrative", group: "Location", text: "Reigate and Banstead" , value: "Reigate and Banstead"},
  {parameter: "districtAdministrative", group: "Location", text: "Mole Valley" , value: "Mole Valley"},
  {parameter: "districtAdministrative", group: "Location", text: "Guildford" , value: "Guildford"},
  {parameter: "districtAdministrative", group: "Location", text: "Epsom and Ewell" , value: "Epsom and Ewell"},
  {parameter: "districtAdministrative", group: "Location", text: "Spelthorne" , value: "Spelthorne"},
  {parameter: "districtAdministrative", group: "Location", text: "Tandridge" , value: "Tandridge"},
  {parameter: "districtAdministrative", group: "Location", text: "Surrey Heath" , value: "Surrey Heath"},
  {parameter: "districtAdministrative", group: "Location", text: "Sutton" , value: "Sutton"},
  {parameter: "districtAdministrative", group: "Location", text: "Mid Suffolk" , value: "Mid Suffolk"},
  {parameter: "districtAdministrative", group: "Location", text: "Babergh" , value: "Babergh"},
  {parameter: "districtAdministrative", group: "Location", text: "Waveney" , value: "Waveney"},
  {parameter: "districtAdministrative", group: "Location", text: "St Edmundsbury" , value: "St Edmundsbury"},
  {parameter: "districtAdministrative", group: "Location", text: "Suffolk Coastal" , value: "Suffolk Coastal"},
  {parameter: "districtAdministrative", group: "Location", text: "Forest Heath" , value: "Forest Heath"},
  {parameter: "districtAdministrative", group: "Location", text: "Mid Sussex" , value: "Mid Sussex"},
  {parameter: "districtAdministrative", group: "Location", text: "Horsham" , value: "Horsham"},
  {parameter: "districtAdministrative", group: "Location", text: "Chichester" , value: "Chichester"},
  {parameter: "districtAdministrative", group: "Location", text: "Adur" , value: "Adur"},
  {parameter: "districtAdministrative", group: "Location", text: "Worthing" , value: "Worthing"},
  {parameter: "districtAdministrative", group: "Location", text: "Arun" , value: "Arun"},
  {parameter: "districtAdministrative", group: "Location", text: "Crawley" , value: "Crawley"},
  {parameter: "districtAdministrative", group: "Location", text: "Salisbury" , value: "Salisbury"},
  {parameter: "districtAdministrative", group: "Location", text: "North Wiltshire" , value: "North Wiltshire"},
  {parameter: "districtAdministrative", group: "Location", text: "Kennet" , value: "Kennet"},
  {parameter: "districtAdministrative", group: "Location", text: "West Wiltshire" , value: "West Wiltshire"},
  {parameter: "districtAdministrative", group: "Location", text: "Swindon" , value: "Swindon"},
  {parameter: "districtAdministrative", group: "Location", text: "Camden" , value: "Camden"},
  {parameter: "districtAdministrative", group: "Location", text: "Hammersmith and Fulham" , value: "Hammersmith and Fulham"},
  {parameter: "districtAdministrative", group: "Location", text: "Redbridge" , value: "Redbridge"},
  {parameter: "districtAdministrative", group: "Location", text: "Islington" , value: "Islington"},
  {parameter: "districtAdministrative", group: "Location", text: "Ealing" , value: "Ealing"},
  {parameter: "districtAdministrative", group: "Location", text: "Haringey" , value: "Haringey"},
  {parameter: "districtAdministrative", group: "Location", text: "Havering" , value: "Havering"},
  {parameter: "districtAdministrative", group: "Location", text: "Hounslow" , value: "Hounslow"},
  {parameter: "districtAdministrative", group: "Location", text: "Newham" , value: "Newham"},
  {parameter: "districtAdministrative", group: "Location", text: "Richmond upon Thames" , value: "Richmond upon Thames"},
  {parameter: "districtAdministrative", group: "Location", text: "Dudley" , value: "Dudley"},
  {parameter: "districtAdministrative", group: "Location", text: "Sandwell" , value: "Sandwell"},
  {parameter: "districtAdministrative", group: "Location", text: "Walsall" , value: "Walsall"},
  {parameter: "districtAdministrative", group: "Location", text: "Denbighshire" , value: "Denbighshire"},
  {parameter: "districtAdministrative", group: "Location", text: "Sir Ddinbych" , value: "Sir Ddinbych"},
  {parameter: "districtAdministrative", group: "Location", text: "Tynedale" , value: "Tynedale"},
  {parameter: "districtAdministrative", group: "Location", text: "Gateshead" , value: "Gateshead"},
  {parameter: "districtAdministrative", group: "Location", text: "Wakefield" , value: "Wakefield"},
  {parameter: "districtAdministrative", group: "Location", text: "Castle Morpeth" , value: "Castle Morpeth"},
  {parameter: "districtAdministrative", group: "Location", text: "Wansbeck" , value: "Wansbeck"},
  {parameter: "districtAdministrative", group: "Location", text: "Isle of Wight" , value: "Isle of Wight"},
  {parameter: "districtAdministrative", group: "Location", text: "Plymouth" , value: "Plymouth"},
  {parameter: "districtAdministrative", group: "Location", text: "Torbay" , value: "Torbay"},
  {parameter: "districtAdministrative", group: "Location", text: "Exeter" , value: "Exeter"},
  {parameter: "districtAdministrative", group: "Location", text: "Restormel" , value: "Restormel"},
  {parameter: "districtAdministrative", group: "Location", text: "Harrow" , value: "Harrow"},
  {parameter: "districtAdministrative", group: "Location", text: "Rugby" , value: "Rugby"},
  {parameter: "districtAdministrative", group: "Location", text: "North Warwickshire" , value: "North Warwickshire"},
  {parameter: "districtAdministrative", group: "Location", text: "Warwick" , value: "Warwick"},
  {parameter: "districtAdministrative", group: "Location", text: "Kingston upon Thames" , value: "Kingston upon Thames"},
  {parameter: "districtAdministrative", group: "Location", text: "Monmouthshire" , value: "Monmouthshire"},
  {parameter: "districtAdministrative", group: "Location", text: "Sir Fynwy" , value: "Sir Fynwy"},
  {parameter: "districtAdministrative", group: "Location", text: "Berwick-upon-Tweed" , value: "Berwick-upon-Tweed"},
  {parameter: "districtAdministrative", group: "Location", text: "East Devon" , value: "East Devon"},
  {parameter: "districtAdministrative", group: "Location", text: "Torridge" , value: "Torridge"},
  {parameter: "districtAdministrative", group: "Location", text: "Fife" , value: "Fife"},
  {parameter: "districtAdministrative", group: "Location", text: "Perth & Kinross" , value: "Perth & Kinross"},
  {parameter: "districtAdministrative", group: "Location", text: "Dumfries & Galloway" , value: "Dumfries & Galloway"},
  {parameter: "districtAdministrative", group: "Location", text: "Blyth Valley" , value: "Blyth Valley"},
  {parameter: "districtAdministrative", group: "Location", text: "Teignbridge" , value: "Teignbridge"},
  {parameter: "districtAdministrative", group: "Location", text: "Caradon" , value: "Caradon"},
  {parameter: "districtAdministrative", group: "Location", text: "Edinburgh, City of" , value: "Edinburgh, City of"},
  {parameter: "districtAdministrative", group: "Location", text: "Cardiff" , value: "Cardiff"},
  {parameter: "districtAdministrative", group: "Location", text: "Caerdydd" , value: "Caerdydd"},
  {parameter: "districtAdministrative", group: "Location", text: "South Hams" , value: "South Hams"},
  {parameter: "districtAdministrative", group: "Location", text: "North Devon" , value: "North Devon"},
  {parameter: "districtAdministrative", group: "Location", text: "North Cornwall" , value: "North Cornwall"},
  {parameter: "districtAdministrative", group: "Location", text: "City of London" , value: "City of London"},
  {parameter: "districtAdministrative", group: "Location", text: "Wrexham" , value: "Wrexham"},
  {parameter: "districtAdministrative", group: "Location", text: "Wrecsam" , value: "Wrecsam"},
  {parameter: "districtAdministrative", group: "Location", text: "Falkirk" , value: "Falkirk"},
  {parameter: "districtAdministrative", group: "Location", text: "Rhondda, Cynon, Taff" , value: "Rhondda, Cynon, Taff"},
  {parameter: "districtAdministrative", group: "Location", text: "Rhondda Cynon Taf" , value: "Rhondda Cynon Taf"},
  {parameter: "districtAdministrative", group: "Location", text: "Merthyr Tydfil" , value: "Merthyr Tydfil"},
  {parameter: "districtAdministrative", group: "Location", text: "Merthyr Tudful" , value: "Merthyr Tudful"},
  {parameter: "districtAdministrative", group: "Location", text: "Caerphilly" , value: "Caerphilly"},
  {parameter: "districtAdministrative", group: "Location", text: "Caerffili" , value: "Caerffili"},
  {parameter: "districtAdministrative", group: "Location", text: "Ynys M\u201Cn" , value: "Ynys M\u201Cn"},
  {parameter: "districtAdministrative", group: "Location", text: "Isle of Anglesey" , value: "Isle of Anglesey"},
  {parameter: "districtAdministrative", group: "Location", text: "Gwynedd" , value: "Gwynedd"},
  {parameter: "districtAdministrative", group: "Location", text: "Conwy" , value: "Conwy"},
  {parameter: "districtAdministrative", group: "Location", text: "Flintshire" , value: "Flintshire"},
  {parameter: "districtAdministrative", group: "Location", text: "Sir y Fflint" , value: "Sir y Fflint"},
  {parameter: "districtAdministrative", group: "Location", text: "Powys" , value: "Powys"},
  {parameter: "districtAdministrative", group: "Location", text: "Ceredigion" , value: "Ceredigion"},
  {parameter: "districtAdministrative", group: "Location", text: "Sir Ceredigion" , value: "Sir Ceredigion"},
  {parameter: "districtAdministrative", group: "Location", text: "Sir Benfro" , value: "Sir Benfro"},
  {parameter: "districtAdministrative", group: "Location", text: "Pembrokeshire" , value: "Pembrokeshire"},
  {parameter: "districtAdministrative", group: "Location", text: "Carmarthenshire" , value: "Carmarthenshire"},
  {parameter: "districtAdministrative", group: "Location", text: "Sir Gaerfyrddin" , value: "Sir Gaerfyrddin"},
  {parameter: "districtAdministrative", group: "Location", text: "Swansea" , value: "Swansea"},
  {parameter: "districtAdministrative", group: "Location", text: "Abertawe" , value: "Abertawe"},
  {parameter: "districtAdministrative", group: "Location", text: "Neath Port Talbot" , value: "Neath Port Talbot"},
  {parameter: "districtAdministrative", group: "Location", text: "Castell-nedd Port Talbot" , value: "Castell-nedd Port Talbot"},
  {parameter: "districtAdministrative", group: "Location", text: "Bridgend" , value: "Bridgend"},
  {parameter: "districtAdministrative", group: "Location", text: "Pen-y-bont ar Ogwr" , value: "Pen-y-bont ar Ogwr"},
  {parameter: "districtAdministrative", group: "Location", text: "The Vale of Glamorgan" , value: "The Vale of Glamorgan"},
  {parameter: "districtAdministrative", group: "Location", text: "Bro Morgannwg" , value: "Bro Morgannwg"},
  {parameter: "districtAdministrative", group: "Location", text: "Alnwick" , value: "Alnwick"},
  {parameter: "districtAdministrative", group: "Location", text: "Mid Devon" , value: "Mid Devon"},
  {parameter: "districtAdministrative", group: "Location", text: "West Devon" , value: "West Devon"},
  {parameter: "districtAdministrative", group: "Location", text: "West Lothian" , value: "West Lothian"},
  {parameter: "districtAdministrative", group: "Location", text: "Newport" , value: "Newport"},
  {parameter: "districtAdministrative", group: "Location", text: "Casnewydd" , value: "Casnewydd"},
  {parameter: "districtAdministrative", group: "Location", text: "Torfaen" , value: "Torfaen"},
  {parameter: "districtAdministrative", group: "Location", text: "Tor-faen" , value: "Tor-faen"},
  {parameter: "districtAdministrative", group: "Location", text: "Blaenau Gwent" , value: "Blaenau Gwent"},
  {parameter: "districtAdministrative", group: "Location", text: "Aberdeen City" , value: "Aberdeen City"}]


  // Config
  var paramTemplate = urltemplate.parse(' ?___{key} rdfs:label "{value}" . ?item {namespace}:{key} ?___{key} .');
  var tupleTemplate = urltemplate.parse(' {object_1} {relationship} {object_2} . ');
  var prefixes = 'PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#> PREFIX school: <http://education.data.gov.uk/def/school/>';
  var select = ' SELECT ?name ?item ?type';
  var where  = ' WHERE { ?item rdf:type school:School . ?item rdfs:label ?name . ?item school:typeOfEstablishment ?typeCode . ?typeCode rdfs:label ?type .';
  var limit  = ' } OFFSET 0 LIMIT 200';
  var base_url = 'http://education.data.gov.uk/sparql/education/query?query=';

  $('#query').chosen();

  var app = app || {};

  app.Condition = Backbone.Model.extend({
    defaults: function() {
      return {
        group: null,
        selected: false,
        selectable: true,
        orderSelected: 0
      };
    },
    select: function() {
      this.set('orderSelected', app.Conditions.selectedCount() + 1);
      this.save({selected: true});
    },
    deselect: function() {
      this.set('orderSelected', 0);
      this.save({selected: false});
    },
    selectedAttribute: function() {
      if (this.get('selected')) {
        return " selected";
      } else {
        return "";
      }
    }
  });

  var ConditionList = Backbone.Collection.extend({
    model: app.Condition,
    localStorage: new Backbone.LocalStorage("conditions-backbone"),
    comparator:  "text",
    allowedGroups: function() {
      possibleGroups = ["Phase", "Location", "Type"];
      selectedGroups = _.map(this.selected(), function (school) {
        return school.get('group');
      });
      return _.difference(possibleGroups, selectedGroups);
    },
    selectable: function() {

      allowedGroups = this.allowedGroups();
      resultsLessThanOnePage = app.schools.length < 200;

      conditionsSelected = this.selected();
      conditionsAllowedByGroup = this.filter(function (condition) { 
        return _.contains(allowedGroups, condition.get('group'))
      });
      
      if (resultsLessThanOnePage) {
        // Calculate types of establishments limited by results
        typeConditions = _.select(conditionsAllowedByGroup, function(condition) {
          return condition.get('group') == "Type";
        });

        typesWithinResults = _.uniq(app.schools.map(function(school) {
          return school.get("type");
        }));
        typeConditionsLimitedByResults = _.filter(typeConditions, function (condition) { 
          return _.contains(typesWithinResults, condition.get('value'));
        });

        nontypeConditions = _.difference(conditionsAllowedByGroup, typeConditions);
        return _.union(conditionsSelected, nontypeConditions, typeConditionsLimitedByResults)
      } else {
        return _.union(conditionsSelected, conditionsAllowedByGroup);
      }

    },
    selected: function() {
      return _.sortBy(this.where({selected: true}), function(condition) { return condition.get("orderSelected") });
    },
    selectedCount: function() {
      return this.selected().length;
    },
    allowGroup: function(group) {
      this.forEach(function(condition) {
        if(condition.get('group') == group || condition.get('selected')) {
          condition.set('selectable', true);
        } else {
          condition.set('selectable', false)
        };
        condition.save();
      });
    },
    select: function(id) {
      selectedCondition = app.Conditions.findWhere({id: id});
      selectedCondition.select();
    },
    deselect: function (id) {
      deselectedCondition = app.Conditions.findWhere({id: id});
      deselectedCondition.deselect();
    },
    updateAll: function() {
      var collection = this;
      options = {
        success: function(model, resp, xhr) {
          collection.reset(model);
        }
      };
      return Backbone.sync('update', this, options);
    },
    saveAll: function() {
      Backbone.sync('save', this, {
        success: function(){
          console.log('users saved!');
        } 
      })
    }
  });
app.Conditions = new ConditionList();
app.Conditions.fetch();

app.ConditionGroupView = Backbone.View.extend({
  template: _.template($("#condition-group-template").html()),

  initialize: function () {
   this.listenTo(app.Conditions, 'add', this.add);
 },

 add: function(condition) {
   condition.save();
 },
 render: function() {
  var selectable = _.sortBy(app.Conditions.selectable(), function(condition) { return condition.get('orderSelected') });
  var groups = _.groupBy(selectable, function(object) { return object.get('group') });
  this.el = this.template({groups: groups});
  $('#query').children().remove();
  $('#query').append(this.el);
  $('#query').trigger('chosen:updated');
  return this;
},
});

app.SelectedConditionsGroupView = Backbone.View.extend({
  template: _.template($("#selected-conditions-template").html()),
  conditions: function() {
    return app.Conditions.where({selected: true});
  },
  render: function() {
    $('#results').html(this.template({conditions: this.conditions}));
  },
});

var SchoolList = Backbone.Collection.extend({
  comparator: "name",
  url: function() {
    encodedPrefixes = encodeURIComponent(prefixes)
    encodedSelect   = encodeURIComponent(select)
    encodedWhere    = encodeURIComponent(where);
    encodedLimit    = encodeURIComponent(limit);
    selectedConditions = app.Conditions.where({selected: true});
    encodedSearchParameters = selectedConditions.map(function(condition) { 
      return paramTemplate.expand({
        key: condition.get('parameter'), 
        namespace: "school", 
        value: condition.get('value')
      });
    }).join(" ");
    encodedFormat   = '&output=json&stylesheet=xml-to-html.xsl&force-accept=text%2Fplain';

    return base_url + encodedPrefixes + encodedSelect + encodedWhere + encodedSearchParameters + encodedLimit + encodedFormat;
  },
  parse: function (raw_response) {
    console.log("just parsed");
    data = raw_response.results.bindings.map(function(result) { 
      return {"item":result.item.value, "name":result.name.value, "type":result.type.value}; 
    });
    return data;
  },
  update: function() {
    this.fetch({ 
      dataType: "jsonp",
      success: (function(data) {
        app.schoolsView.render();
        app.conditionsGroupView.render();
      }),
      error: (function(data) {
        console.log("Error");
      }),
      complete: (function(data) {
        console.log("Complete");
      })
    });
  }
});
app.schools = new SchoolList();

SchoolsView = Backbone.View.extend({
  template: _.template($('#results-template').html()),
  render: function() {
    $('#results').html(this.template({schools: app.schools.toArray()}));
  }
})

  app.conditionsGroupView = new app.ConditionGroupView(); // Start the conditions view
  app.selectedConditionsView = new app.SelectedConditionsGroupView();
  app.schoolsView = new SchoolsView();

  if (app.Conditions.length == 0) {
    app.Conditions.add([
      {parameter: "phaseOfEducation", group: "Phase", text: "Primary", value: "Primary"},
      {parameter: "phaseOfEducation", group: "Phase", text: "Secondary", value: "Secondary"}
      ]);
    app.Conditions.add(districtAdministratives);
    app.Conditions.add(typeOfEstablishments);
  };

  app.schools.update();

  $('#query').on('change', function(evt, params) {
    conditionWasSelected = params.selected != null;
    if (conditionWasSelected) {
      app.Conditions.select(params.selected);
    } else {
      app.Conditions.deselect(params.deselected);
    };
    app.schools.update();
    
  });

});


</script>
</html>
