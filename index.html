<!DOCTYPE html>
<html>
<head>
  <title>Treasure JS Proof of Concept</title>
  <link href="css/application.css?body=1" media="all" rel="stylesheet" type="text/css">
  <link href="css/chosen.css?body=1" media="all" rel="stylesheet" type="text/css">
  <link href="select2/select2.css" media="all" rel="stylesheet" type="text/css">
  <meta content="authenticity_token" name="csrf-param">
  <meta content="JeN23VMeqzt9GSvOwBWhr3Zo+qkV7gg89R7Fd2Qkvpo=" name="csrf-token">

  <script type="text/javascript" src='jquery/jquery.js'></script>
  <script type="text/javascript" src='node_modules/backbone/node_modules/underscore/underscore.js'></script>
  <script type="text/javascript" src='node_modules/backbone/backbone.js'></script>
  <script type="text/javascript" src='node_modules/backbone.localstorage/backbone.localStorage.js'></script>
  <script type="text/javascript" src='backbone-autocomplete.js'></script>
  <script type="text/javascript" src='backbone.autocomplete.js'></script>
</head>
<body>
  <h1>Treasure JS Proof of Concept</h1>
  <form id="autocomplete-remote">
    <input id="plugin" autocomplete="off" style="width: 200px">
  </form>
  <div id="r"></div>
</body>
<script type="text/javascript">

$(function () {

  var Plugin = Backbone.Model.extend({
    label: function () {
      return this.get("value");
    }
  });

  var PluginCollection = Backbone.Collection.extend({
    url: function() { return 'http://localhost:3000/api/v1/searches.json' },
    model: Plugin
  });

  
  var plugins = new PluginCollection([]);

  new AutoCompleteView({
    input: $("#plugin"),
    model: plugins,
    wait: 50,
    queryParameter: "q",
    minKeywordLength: 0,
    onSelect: function (model) {
      $("#selected").show().find("p").html(model.label());
    }
  }).render();

});
</script>

<script>
autocompleteRemote = new Backbone.AutocompleteList({
  url: function() { return 'http://localhost:3000/api/v1/searches.json?q=' + $('form#autocomplete-remote input[name=search]').val() },
  filter: null,
  el: $('form#autocomplete-remote input[name=search]'),
  template: _.template('<p class="result"><%= value %> (<%= name %>)</p>'),
  delay: 100,
  minLength: 1,
  value: function(model) { return model.get('value') },
  name: function(model) { return model.get('name') },
}).resultsView.collection.parse = function(resp) {
  return resp.terms;
};

</script>
</html>
