<!DOCTYPE html>
<html>
<head>
  <title>Treasure JS Proof of Concept</title>
  <link href="css/application.css" media="all" rel="stylesheet" type="text/css">
  <link href="select2/select2.css" media="all" rel="stylesheet" type="text/css">
  <meta content="authenticity_token" name="csrf-param">
  <meta content="JeN23VMeqzt9GSvOwBWhr3Zo+qkV7gg89R7Fd2Qkvpo=" name="csrf-token">

  <script type="text/javascript" src='jquery/jquery.js'></script>
  <script type="text/javascript" src='select2/select2.js'></script>
  <script type="text/javascript" src='node_modules/backbone/node_modules/underscore/underscore.js'></script>
  <script type="text/javascript" src='node_modules/backbone/backbone.js'></script>
  <script type="text/javascript" src='node_modules/backbone.localstorage/backbone.localStorage.js'></script>
  <script type="text/javascript" src='backbone.autocomplete.js'></script>
</head>
<body>
  <h1>Treasure JS Proof of Concept</h1>
  <form id="autocomplete-remote">
    <input id="plugin" autocomplete="off">
    <input id="select2" autocomplete="off">
  </form>

  <form id="formy-form">
    <input id="inny">
  </form>
  <div id="r"></div>
</body>
<script type="text/javascript">

$(function () {

  var Term = Backbone.Model.extend({
    label: function () {
      return this.get("value");
    }
  });

  var Terms = Backbone.Collection.extend({
    url: function() { return 'http://localhost:3000/api/v1/searches.json' },
    model: Term
  });

  var terms = new Terms([]);

  var Query = Backbone.Collection.extend({
    model: Term
  });

  var query = new Query([]);
  query.on("add", function(term) {
    console.log("Term added: " + term);
  });

  new AutoCompleteView({
    input: $("#plugin"),
    model: terms,
    wait: 50,
    queryParameter: "q",
    minKeywordLength: 0,
    onSelect: function (model) {
      query.add(model);
    }
  }).render();

  $(document).ready(function() {
    $('#select2').select2({
      initSelection : function (element, callback) {
        var data = [];
        $(element.val().split(" ")).each(function () {
            data.push({id: this, text: this});
        });
        callback(data);
      },
      multiple: true,
      minimumInputLength: 0,
      closeOnSelect: true,
      ajax: { 
        url: 'http://jgmacbookpro.local:3000/api/v1/searches.json',
        // dataType: 'json',
        data: function (term, page) {
            return {
                q: term,
                terms: $('#select2').select2("val")
            };
        },
        results: function (data, page) { 
            return {results: data};
        }
      }
    });
    // $('#select2').on("change", function(e) { 
    //   $('#select2').select2("open");
    //   this.style.webkitTransform = 'translate3d(0px,-10000px,0)'; 
    //   webkitRequestAnimationFrame(function() { 
    //     this.style.webkitTransform = ''; 
    //     $(document).scrollTop(80);
    //     $(document).scrollLeft(10);
    //   }.bind(this));
    // });
    
    // $('.select2-input').on("keyup focus click", function(e) {
    //   // $(document).scrollTop(80);
    //   // $(document).scrollLeft(10);
    //   e.stopImmediatePropagation();
    //   e.preventDefault();
    //   return false;
    // });

    // $('input').on("keyup focus click", function(e) {
    //   // $(document).scrollTop(80);
    //   // $(document).scrollLeft(10);
    //   e.stopImmediatePropagation();
    //   e.preventDefault();
    //   return false;
    // });
    
    $('#inny').on("focus click keyup", function(e) {
      this.style.webkitTransform = 'translate3d(0px,-10000px,0)'; 
      webkitRequestAnimationFrame(function() { 
        this.style.webkitTransform = ''; 
        $(document).scrollTop(80);
        $(document).scrollLeft(10);
        return false;
      }.bind(this));
    });

    // $('#s2id_autogen1').on("focus click keyup", function(e) {
    //   this.style.webkitTransform = 'translate3d(0px,-10000px,0)'; 
    //   webkitRequestAnimationFrame(function() { 
    //     this.style.webkitTransform = ''; 
    //     $(document).scrollTop(80);
    //     $(document).scrollLeft(10);
    //   }.bind(this));
    // });

    $('#select2').on("select2-focus select2-selecting select2-opening change", function(e) {
      this.style.webkitTransform = 'translate3d(0px,-10000px,0)'; 
      e.stopImmediatePropagation();
      webkitRequestAnimationFrame(function(e) { 
        this.style.webkitTransform = ''; 
        $(document).scrollTop(80);
        $(document).scrollLeft(10);
        e.stopImmediatePropagation();
      }.bind(this));
    });

  });

});
</script>


</script>
</html>
