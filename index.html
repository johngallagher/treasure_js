<!DOCTYPE html>
<html>
<head>
  <title>Treasure JS Proof of Concept</title>
  <link href="css/application.css" media="all" rel="stylesheet" type="text/css">
  <link href="select2/select2.css" media="all" rel="stylesheet" type="text/css">
  <meta content="authenticity_token" name="csrf-param">
  <meta content="JeN23VMeqzt9GSvOwBWhr3Zo+qkV7gg89R7Fd2Qkvpo=" name="csrf-token">
  <meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0;">

  <script type="text/javascript" src='jquery/jquery.js'></script>
  <script type="text/javascript" src='select2/select2.js'></script>
  <script type="text/javascript" src='node_modules/backbone/node_modules/underscore/underscore.js'></script>
  <script type="text/javascript" src='node_modules/backbone/backbone.js'></script>
  <script type="text/javascript" src='node_modules/backbone.localstorage/backbone.localStorage.js'></script>
  <script type="text/javascript" src='backbone.autocomplete.js'></script>
</head>
<body>
  <h1>Treasure JS Proof of Concept</h1>
  <form id="autocomplete-remote">
    <input id="plugin" autocomplete="off">
    <input id="select2" autocomplete="off">
  </form>

  <p>This works...</p>
  <input onfocus="$(this).hide(); webkitRequestAnimationFrame(function() { $(document).scrollTop(120); $(this).show(); }.bind(this))"/>
  <div id="r"></div>
</body>
<script type="text/javascript">

$(function () {

  var Term = Backbone.Model.extend({
    label: function () {
      return this.get("value");
    }
  });

  var Terms = Backbone.Collection.extend({
    url: function() { return 'http://localhost:3000/api/v1/searches.json' },
    model: Term
  });

  var terms = new Terms([]);

  var Query = Backbone.Collection.extend({
    model: Term
  });

  var query = new Query([]);
  query.on("add", function(term) {
    console.log("Term added: " + term);
  });

  $(document).ready(function() {
    $('#select2').select2({
      initSelection : function (element, callback) {
        var data = [];
        $(element.val().split(" ")).each(function () {
            data.push({id: this, text: this});
        });
        callback(data);
      },
      multiple: true,
      minimumInputLength: 0,
      closeOnSelect: true,
      width: "off",
      ajax: { 
        url: 'http://jgmacbookpro.local:3000/api/v1/searches.json',
        // dataType: 'json',
        data: function (term, page) {
            return {
                q: term,
                terms: $('#select2').select2("val")
            };
        },
        results: function (data, page) { 
            return {results: data};
        }
      }
    });
    $('#select2').on("change", function(e) { 
      $('#select2').select2("open");
    });
    
    $('#s2id_autogen1').on("focus", function(e) {
      $(this).hide();
      webkitRequestAnimationFrame(function() { 
        $(document).scrollTop(95);
        $(document).scrollLeft(8);
        $(this).show();
      }.bind(this));
    });
    

  });

});

</script>
</html>
